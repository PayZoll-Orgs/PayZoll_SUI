"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5196],{21934:(e,t,a)=>{a.d(t,{U:()=>s});var r=a(74228);let s={getAllEmployees:async()=>(await r.A.get("/employee/")).data,getEmployeeByWallet:async e=>(await r.A.get("/employee/".concat(e))).data,addEmployee:async e=>(await r.A.post("/employee/add",e)).data,getEmployeePayroll:async e=>(await r.A.get("/employee/payroll/".concat(e))).data,bulkUploadEmployees:async e=>(await r.A.post("/employee/bulk-upload",e,{headers:{"Content-Type":"multipart/form-data"}})).data,updateEmployee:async(e,t)=>(await r.A.patch("/employee/update/".concat(e),t)).data,deleteEmployee:async e=>(await r.A.delete("/employee/delete/".concat(e))).data}},25305:(e,t,a)=>{a.d(t,{E1:()=>n,QC:()=>o,S1:()=>u,VR:()=>m,ab:()=>d,vC:()=>l,yU:()=>i});var r=a(74228);let s={ADDRESS_BOOK:"/addressBook",SEARCH:"/addressBook/search"},o=async()=>(await r.A.get(s.ADDRESS_BOOK)).data,l=async e=>(await r.A.get("".concat(s.SEARCH,"?query=").concat(encodeURIComponent(e)))).data,n=async(e,t,a)=>(await r.A.post(s.ADDRESS_BOOK,{nickname:e,walletAddress:t,email:a})).data,i=async(e,t)=>(await r.A.patch("".concat(s.ADDRESS_BOOK,"/").concat(encodeURIComponent(e)),t)).data,d=async e=>{await r.A.delete("".concat(s.ADDRESS_BOOK,"/").concat(encodeURIComponent(e)))},c=async e=>(await r.A.get("".concat(s.ADDRESS_BOOK,"/").concat(encodeURIComponent(e)))).data,u=async e=>{if(/^0x[a-fA-F0-9]{64}$/.test(e))return e;let t=e.startsWith("@")?e.substring(1):e;try{return(await c(t)).data.walletAddress}catch(e){throw Error('Could not resolve nickname "'.concat(t,'" to a wallet address'))}},m=async e=>(await r.A.post("".concat(s.ADDRESS_BOOK,"/from-invoice"),{invoiceId:e})).data},35196:(e,t,a)=>{a.d(t,{AuthProvider:()=>p,O:()=>h,A:()=>g});var r=a(95155),s=a(12115),o=a(35695),l=a(31530),n=a(64767);a(21934),a(94860),a(74228),a(51931),a(25305),a(53791);var i=a(10351);let d=e=>{let{t,icon:a,title:s,message:o,borderColor:l}=e;return(0,r.jsx)("div",{className:"".concat(t.visible?"animate-enter":"animate-leave"," max-w-md w-full bg-white dark:bg-black dark:text-white text-black shadow-lg rounded-lg pointer-events-auto flex border-l-4 ").concat(l),children:(0,r.jsx)("div",{className:"flex-1 w-0 p-4",children:(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)("div",{className:"flex-shrink-0 pt-0.5",children:a}),(0,r.jsxs)("div",{className:"ml-3 flex-1",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:s}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-800 dark:text-gray-400",children:o})]})]})})})},c=["/","/login","/register","/forgot-password","/pages/services","/pages/auth","/pages/ramps","/pages/admin","/pages/p2p","/pages/about","/pages/payroll","/pages/streaming","/pages/audit"],u=["/pages/payroll-sui","/pages/p2p-sui"],m=(0,s.createContext)(void 0),p=e=>{let{children:t}=e,[a,p]=(0,s.useState)(null),[g,h]=(0,s.useState)(!0),[y,w]=(0,s.useState)(null),[x,f]=(0,s.useState)(!1),A=(0,o.useRouter)(),v=(0,o.usePathname)(),b=e=>{try{let t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),a=decodeURIComponent(atob(t).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(a)}catch(e){return console.error("Error parsing token:",e),null}},S=e=>!e||Date.now()/1e3>e,j=()=>{localStorage.removeItem("authToken"),localStorage.removeItem("user"),p(null),w(null),A.replace("/")},E=async e=>{try{h(!0);let t=await n.Z.login(e);if(null==t?void 0:t.token){let a=b(t.token);if(a)w(a.exp),localStorage.setItem("authToken",t.token),e.authMode&&localStorage.setItem("authMode",e.authMode);else throw Error("Invalid token structure received")}else throw Error("No authentication token received");if(null==t?void 0:t.safeUser)return p(t.safeUser),localStorage.setItem("user",JSON.stringify(t.safeUser)),l.oR.custom(e=>(0,r.jsx)(d,{t:e,icon:(0,r.jsx)(i.A3x,{className:"h-6 w-6 text-green-500"}),title:"Login Successful",message:"Welcome back, ".concat(t.safeUser.email,"!"),borderColor:"border-green-500"})),"payroll"===e.authMode?A.push("/pages/payroll-sui"):"p2p"===e.authMode?A.push("/pages/p2p-sui"):t.safeUser.isAdmin?A.push("/pages/payroll-sui"):A.push("/pages/employee"),{success:!0};throw Error("Invalid user data received")}catch(s){var t,a;console.error("Login error:",s);let e=(null==(a=s.response)||null==(t=a.data)?void 0:t.message)||"Failed to login. Please try again.";return l.oR.custom(t=>(0,r.jsx)(d,{t:t,icon:(0,r.jsx)(i.q_G,{className:"h-6 w-6 text-red-500"}),title:"Login Failed",message:e,borderColor:"border-red-500"})),{success:!1,error:e}}finally{h(!1)}},R=async e=>{try{return h(!0),await n.Z.register(e),l.oR.custom(e=>(0,r.jsx)(d,{t:e,icon:(0,r.jsx)(i.vq3,{className:"h-6 w-6 text-green-500"}),title:"Registration Successful",message:"Account created. Logging you in...",borderColor:"border-green-500"}),{duration:2e3}),await E({email:e.email,password:e.password,authMode:e.authMode})}catch(s){var t,a;console.error("Registration error:",s);let e=(null==(a=s.response)||null==(t=a.data)?void 0:t.message)||"Failed to register. Please try again.";return l.oR.custom(t=>(0,r.jsx)(d,{t:t,icon:(0,r.jsx)(i.q_G,{className:"h-6 w-6 text-red-500"}),title:"Registration Failed",message:e,borderColor:"border-red-500"})),{success:!1,error:e}}finally{h(!1)}};(0,s.useEffect)(()=>{if(!y)return;let e=y-Date.now()/1e3,t=null,s=null;return e>300?(t=setTimeout(()=>{l.oR.custom(e=>(0,r.jsx)(d,{t:e,icon:(0,r.jsx)(i.eHT,{className:"h-6 w-6 text-yellow-500"}),title:"Session Warning",message:"Your session will expire in 5 minutes.",borderColor:"border-yellow-500"}),{duration:1e4})},(e-300)*1e3),s=setTimeout(()=>{j(),l.oR.custom(e=>(0,r.jsx)(d,{t:e,icon:(0,r.jsx)(i.Ohp,{className:"h-6 w-6 text-red-500"}),title:"Session Expired",message:"Your session has ended. Please login again.",borderColor:"border-red-500"}))},1e3*e)):e>0?s=setTimeout(()=>{j(),l.oR.custom(e=>(0,r.jsx)(d,{t:e,icon:(0,r.jsx)(i.Ohp,{className:"h-6 w-6 text-red-500"}),title:"Session Expired",message:"Your session has ended. Please login again.",borderColor:"border-red-500"}))},1e3*e):a&&(j(),l.oR.custom(e=>(0,r.jsx)(d,{t:e,icon:(0,r.jsx)(i.Ohp,{className:"h-6 w-6 text-red-500"}),title:"Session Expired",message:"Your session has ended. Please login again.",borderColor:"border-red-500"}))),()=>{t&&clearTimeout(t),s&&clearTimeout(s)}},[y,a]);let k=async()=>{let e=localStorage.getItem("authToken"),t=localStorage.getItem("user");if(!e||!t)return p(null),c.includes(v||"")||"/"===v||A.replace("/"),h(!1),f(!0),!1;try{let a=b(e);if(!a||S(a.exp))throw Error("Token expired");w(a.exp);let s=JSON.parse(t);if(p(s),u.some(e=>null==v?void 0:v.startsWith(e))&&!s.isAdmin)return l.oR.custom(e=>(0,r.jsx)(d,{t:e,icon:(0,r.jsx)(i.del,{className:"h-6 w-6 text-red-500"}),title:"Access Denied",message:"You don't have permission to access this page.",borderColor:"border-red-500"})),A.replace("/"),h(!1),f(!0),!1;return h(!1),f(!0),!0}catch(e){return l.oR.custom(e=>(0,r.jsx)(d,{t:e,icon:(0,r.jsx)(i.Ohp,{className:"h-6 w-6 text-red-500"}),title:"Session Expired",message:"Your session is invalid or has ended. Please login again.",borderColor:"border-red-500"})),j(),h(!1),f(!0),!1}};return(0,s.useEffect)(()=>{k()},[]),(0,s.useEffect)(()=>{if(x){let e=localStorage.getItem("authToken"),t=localStorage.getItem("user");if(!e||!t){c.includes(v||"")||"/"===v||A.replace("/");return}a&&u.some(e=>null==v?void 0:v.startsWith(e))&&!a.isAdmin&&(l.oR.custom(e=>(0,r.jsx)(d,{t:e,icon:(0,r.jsx)(i.del,{className:"h-6 w-6 text-red-500"}),title:"Access Denied",message:"You don't have permission to access this page.",borderColor:"border-red-500"})),A.replace("/"))}},[v,x,a]),(0,s.useEffect)(()=>{let e=setInterval(async()=>{try{let e=await n.Z.ping();e?console.log("Ping successful:",e):console.log("Ping failed")}catch(e){console.log("Ping error:",e)}},45e3);return()=>clearInterval(e)},[]),(0,r.jsx)(m.Provider,{value:{user:a,isAuthenticated:!!a,isLoading:g,isAdmin:null==a?void 0:a.isAdmin,logout:j,login:E,register:R},children:t})},g=()=>{let e=(0,s.useContext)(m);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},h=e=>{let{route:t,children:a,requireAdmin:n=!1}=e,{user:c,isLoading:u,isAdmin:m}=g(),p=(0,o.useRouter)(),[h,y]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{if(!u){if(!c)return void p.replace("/pages/auth");if(n&&!c.isAdmin){l.oR.custom(e=>(0,r.jsx)(d,{t:e,icon:(0,r.jsx)(i.F5$,{className:"h-6 w-6 text-red-500"}),title:"Admin Required",message:"You need administrator privileges for this area.",borderColor:"border-red-500"})),p.replace("/");return}y(!0)}},[c,u,n,m,p,t]),u)?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen min-w-screen",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):h?(0,r.jsx)(r.Fragment,{children:a}):null}},51931:(e,t,a)=>{a.d(t,{A:()=>s});var r=a(74228);let s={subscribeToNewsletter:async e=>{try{return(await r.A.post("/email/subscribe",e)).data}catch(e){return console.error("Newsletter subscription error:",e),{success:!1,message:e.message||"Failed to subscribe to newsletter",error:e.toString()}}},joinWaitlist:async e=>{try{return(await r.A.post("/email/waitlist",e)).data}catch(e){return console.error("Waitlist registration error:",e),{success:!1,message:e.message||"Failed to join waitlist",error:e.toString()}}}}},64767:(e,t,a)=>{a.d(t,{Z:()=>s});var r=a(74228);let s={login:async e=>{var t,a;let s=await r.A.post("/auth/login",e);return(null==(t=s.data)?void 0:t.token)&&localStorage.setItem("authToken",s.data.token),(null==(a=s.data)?void 0:a.safeUser)&&localStorage.setItem("user",JSON.stringify(s.data.safeUser)),console.log("Login response:",s.data),s.data},register:async e=>(await r.A.post("/auth/register",e)).data,forgotPassword:async e=>(await r.A.post("/auth/forgotPassword",{email:e})).data,ping:async()=>(await r.A.post("/auth/ping")).data}},94860:(e,t,a)=>{a.d(t,{U:()=>o});var r=a(74228),s=a(53791);let o={addPayroll:async e=>{try{var t,a,o,l,n,i;console.log("Sending payroll data to API:",e);let d=await r.A.post("/payroll/add",e);console.log("Payroll API response:",d);let c=Date.now().toString();return(null==d||null==(a=d.data)||null==(t=a.data)?void 0:t._id)?c=d.data.data._id:(null==d||null==(l=d.data)||null==(o=l.data)?void 0:o.id)?c=d.data.data.id:(null==d||null==(n=d.data)?void 0:n._id)?c=d.data._id:(null==d||null==(i=d.data)?void 0:i.id)&&(c=d.data.id),console.log("Using recordId for audit:",c),await s.L.storeAuditRecord({recordType:"payroll",recordId:c,timestamp:Date.now(),walletAddresses:e.employees.map(e=>e.wallet),amounts:e.employees.map(e=>parseFloat(e.amount)),totalAmount:parseFloat(e.totalAmount),chain:e.chain.toString(),status:"completed",transactionHash:e.transactionHash}),d.data}catch(t){console.error("Error in addPayroll:",t);try{await s.L.storeAuditRecord({recordType:"payroll",recordId:"failed-".concat(Date.now()),timestamp:Date.now(),walletAddresses:e.employees.map(e=>e.wallet),amounts:e.employees.map(e=>parseFloat(e.amount)),totalAmount:parseFloat(e.totalAmount),chain:e.chain.toString(),status:"failed",transactionHash:e.transactionHash}),console.log("Stored audit record for failed payroll transaction")}catch(e){console.error("Failed to store audit record for failed transaction:",e)}throw t}},getPayrollHistory:async()=>(await r.A.get("/payroll/history")).data}}}]);