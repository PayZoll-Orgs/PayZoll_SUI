(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9626],{29904:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ef});var s=a(95155),r=a(12115),l=a(69882),n=a(31530),d=a(92897),i=a(14891),c=a(53791);let o={devnet:"0x5a9a6c0db570d796c0369cefc05a184fcd24541afa8986e392e6890a3472832d",testnet:"0x5a9a6c0db570d796c0369cefc05a184fcd24541afa8986e392e6890a3472832d",mainnet:"0xe48836adecb638703f5444b2d26fefb729c967c9455334867c3f25a6edc7e610"},m="securetransfer";function x(e){let t=(0,d.YL)(),a=(0,d.eW)(),{mutate:s}=(0,d.Fp)(),{currentNetwork:x}=(null===i.h||void 0===i.h?void 0:(0,i.h)())||{currentNetwork:"testnet"},u=o[x]||o.testnet,[g,b]=(0,r.useState)([]),[y,h]=(0,r.useState)([]),[p,f]=(0,r.useState)(!1),[j,v]=(0,r.useState)({type:"",message:""}),N=(0,r.useCallback)(async()=>{if(t)try{let s=(null==e?void 0:e.address)||"0x2::sui::SUI",r=await a.getCoins({owner:t.address,coinType:s});b(r.data)}catch(t){console.error("Error fetching coins:",t),n.oR.error("Failed to fetch your ".concat((null==e?void 0:e.symbol)||"SUI"," coins"))}},[t,e,a]),k=async(e,t)=>{var r,d;if(!e)return void v({type:"error",message:"Please enter a payment object ID"});let i=y.find(t=>t.parsedJson.payment_object_id===e);if(i&&(null==(r=i.parsedJson.statusInfo)?void 0:r.status)!=="SENT"){v({type:"error",message:"This payment cannot be ".concat(t,"ed because it has status: ").concat(null==(d=i.parsedJson.statusInfo)?void 0:d.status)}),n.oR.error("Payment is not in a ".concat(t,"able state"));return}f(!0),v({type:"info",message:"Preparing transaction..."});try{let r=new l.Z;r.setGasBudget(5e6),r.moveCall({target:"".concat(u,"::").concat(m,"::").concat(t),arguments:[r.object(e)]}),s({transaction:r},{onSuccess:async s=>{v({type:"info",message:"Transaction sent. Checking status..."});try{var r,l,d,i;await new Promise(e=>setTimeout(e,2e3));let o=await a.getTransactionBlock({digest:s.digest,options:{showEffects:!0}});if((null==(l=o.effects)||null==(r=l.status)?void 0:r.status)==="success"){let a="claim"===t?"claimed":"reimbursed";v({type:"success",message:"Payment ".concat(a,"! Transaction digest: ").concat(s.digest)}),n.oR.success("Payment ".concat(a," successfully!"));let r=y.find(t=>t.parsedJson.payment_object_id===e);if(r)try{await c.L.storePaymentRecord(t,r.parsedJson.payment_id||"unknown",e,r.parsedJson.from,r.parsedJson.to,Number(r.parsedJson.amount)/1e9,s.digest),console.log("Payment ".concat(t," record stored in blockchain"))}catch(e){console.error("Failed to store payment ".concat(t," record:"),e)}w(),N()}else{let e=(null==(i=o.effects)||null==(d=i.status)?void 0:d.error)||"Transaction execution failed",a="claim"===t?"Claim":"Reimbursement";v({type:"error",message:"".concat(a," failed: ").concat(e)}),n.oR.error("Failed to ".concat(t," payment: ").concat(e))}}catch(e){console.error("Error checking transaction status:",e),v({type:"error",message:"Unable to verify transaction status: ".concat(e.message)})}finally{f(!1)}},onError:e=>{console.error("Transaction submission failed:",e),v({type:"error",message:"Failed to submit transaction: ".concat(e.message)}),n.oR.error("Transaction error: ".concat(e.message)),f(!1)}})}catch(e){console.error("Transaction preparation failed:",e),v({type:"error",message:"Failed to prepare transaction: ".concat(e.message)}),n.oR.error("Error: ".concat(e.message)),f(!1)}},w=(0,r.useCallback)(async()=>{if(t)try{f(!0);let e=new Map,s=await a.queryEvents({query:{MoveEventType:"".concat(u,"::").concat(m,"::PaymentSent")},limit:50}),r=await a.queryEvents({query:{MoveEventType:"".concat(u,"::").concat(m,"::PaymentClaimed")},limit:50}),l=await a.queryEvents({query:{MoveEventType:"".concat(u,"::").concat(m,"::PaymentReimbursed")},limit:50});r.data.forEach(t=>{var a;let s=t.parsedJson;e.set(s.payment_object_id,{status:"CLAIMED",timestamp:new Date(null!=(a=t.timestampMs)?a:Date.now()).toLocaleString(),by:s.by})}),l.data.forEach(t=>{var a;let s=t.parsedJson;e.set(s.payment_object_id,{status:"REIMBURSED",timestamp:new Date(null!=(a=t.timestampMs)?a:Date.now()).toLocaleString(),by:s.by})});let n=s.data.filter(e=>{let a=e.parsedJson;return a.from===t.address||a.to===t.address}).map(t=>{var a;let s=t.parsedJson,r=e.get(s.payment_object_id)||{status:"SENT",timestamp:new Date(null!=(a=t.timestampMs)?a:Date.now()).toLocaleString()};if(s.payment_id&&s.payment_object_id){let e="payment_sent_".concat(s.payment_id),t=localStorage.getItem("walrus_recorded_payments")||"{}",a=JSON.parse(t);if(a[e]&&!a["".concat(e,"_with_object_id")])try{c.L.updatePaymentObjectId(s.payment_id,s.payment_object_id),a["".concat(e,"_with_object_id")]=!0,localStorage.setItem("walrus_recorded_payments",JSON.stringify(a))}catch(e){console.warn("Failed to update payment object ID in blockchain:",e)}}return{...t,parsedJson:{...s,statusInfo:r}}});h(n)}catch(e){console.error("Error fetching payments:",e),n.oR.error("Failed to fetch payment history")}finally{f(!1)}},[t,a,u]),S=async(e,r,d)=>{if(f(!0),v({type:"",message:""}),!e||!r||!d){v({type:"error",message:"Please fill all required fields"}),f(!1);return}let i=parseFloat(d);if(isNaN(i)||i<=0){v({type:"error",message:"Please enter a valid amount greater than zero"}),f(!1);return}let o=Math.floor(1e9*i);if(0===g.length){v({type:"error",message:"No coins found in wallet"}),f(!1);return}let x=[...g].sort((e,t)=>Number(t.balance)-Number(e.balance))[0];if(Number(x.balance)<o){v({type:"error",message:"Insufficient balance. Needed: ".concat(i," SUI, Available: ").concat(Number(x.balance)/1e9," SUI")}),f(!1);return}try{let i=new l.Z;i.setGasBudget(1e7);let x=Array.from(new TextEncoder().encode(e)),g=BigInt(o),[b]=i.splitCoins(i.gas,[i.pure.u64(g)]);i.moveCall({target:"".concat(u,"::").concat(m,"::send_to"),arguments:[i.pure.vector("u8",x),i.pure.address(r),b]}),s({transaction:i},{onSuccess:async s=>{v({type:"info",message:"Transaction sent. Checking status..."});try{var l,i,o,m;await new Promise(e=>setTimeout(e,2e3));let x=await a.getTransactionBlock({digest:s.digest,options:{showEffects:!0}});if((null==(i=x.effects)||null==(l=i.status)?void 0:l.status)==="success"){v({type:"success",message:"Payment sent! Transaction digest: ".concat(s.digest)}),n.oR.success("Payment sent successfully!");try{let a="payment_sent_".concat(e),l=localStorage.getItem("walrus_recorded_payments")||"{}",n=JSON.parse(l);n[a]?console.log("Payment already recorded in blockchain, skipping duplicate"):(await c.L.storePaymentRecord("send",e,"",(null==t?void 0:t.address)||"",r,parseFloat(d),s.digest),console.log("Payment record stored in blockchain"),n[a]=!0,localStorage.setItem("walrus_recorded_payments",JSON.stringify(n)))}catch(e){console.error("Failed to store payment record:",e)}w(),N()}else{let e=(null==(m=x.effects)||null==(o=m.status)?void 0:o.error)||"Transaction execution failed";v({type:"error",message:"Payment failed: ".concat(e)}),n.oR.error("Failed to send payment: ".concat(e))}}catch(e){console.error("Error checking transaction status:",e),v({type:"error",message:"Unable to verify payment status: ".concat(e.message)})}finally{f(!1)}},onError:e=>{console.error("Send payment failed:",e),v({type:"error",message:"Send payment failed: ".concat(e.message)}),n.oR.error("Failed to send payment: ".concat(e.message)),f(!1)}})}catch(e){console.error("Transaction preparation failed:",e),v({type:"error",message:"Failed to prepare transaction: ".concat(e.message)}),n.oR.error("Error: ".concat(e.message)),f(!1)}},[A]=(0,r.useState)(new Set);return(0,r.useEffect)(()=>{t&&(N(),w())},[t,x,e,N,w]),{currentAccount:t,coinObjects:g,payments:y,isLoading:p,resultMessage:j,setResultMessage:v,sendPayment:S,executePaymentAction:k,fetchPayments:w,fetchUserCoins:N}}var u=a(37030),g=a(10671),b=a(60760),y=a(34835),h=a(54416),p=a(74783),f=a(35196),j=a(35372);let v=e=>{let{selectedToken:t,onTokenChange:a}=e,{user:l,logout:n}=(0,f.A)(),[d,i]=(0,r.useState)(!1),[c,o]=(0,r.useState)(!1),m=(0,r.useRef)(null),x=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=e=>{m.current&&!m.current.contains(e.target)&&x.current&&!x.current.contains(e.target)&&o(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let u=e=>{e(),o(!1)};return(0,s.jsxs)("div",{className:"mb-6 sm:mb-8 px-4 md:px-6 lg:px-8 w-full",children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center space-y-4 md:space-y-0 relative",children:[(0,s.jsxs)("div",{className:"w-full md:w-auto",children:[(0,s.jsx)("h1",{className:"text-lg sm:text-2xl md:text-3xl lg:text font-bold text-black dark:text-white",children:(null==l?void 0:l.company)||"PayZoll Dashboard"}),(0,s.jsx)("h3",{className:"text-md sm:text-lg md:text-xl text-black dark:text-white",children:(null==l?void 0:l.email)||"Email"}),(0,s.jsx)("p",{className:"text-sm hidden sm:block sm:text-base md:text-lg text-gray-600 dark:text-gray-300 mt-1",children:"Secure and recoverable | P2P | Invoice | Subscriptions | Split Bills | payments"})]}),(0,s.jsxs)("div",{className:"hidden md:flex items-center space-x-3 lg:space-x-4",children:[(0,s.jsx)(j.A,{selectedToken:t,onTokenChange:a}),(0,s.jsxs)(g.P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>i(!0),className:"relative text-white py-2 px-3 lg:py-2.5 lg:px-4 rounded-lg backdrop-blur-md bg-blue-500 border border-blue-400 shadow-md hover:shadow-lg transition-all duration-300 hover:bg-gradient-to-r hover:from-indigo-400 hover:to-indigo-600 hover:border-indigo-500 flex items-center justify-center gap-2",title:"Logout",children:[(0,s.jsx)(y.A,{className:"h-4 w-4 lg:h-5 lg:w-5"}),(0,s.jsx)("span",{className:"hidden lg:inline font-medium text-sm whitespace-nowrap",children:"Logout"})]})]}),(0,s.jsx)("div",{className:"md:hidden absolute top-0 right-0 mt-1 mr-1",children:(0,s.jsx)(g.P.button,{ref:x,whileTap:{scale:.95},onClick:()=>o(!c),className:"p-2 rounded-lg bg-gray-200/50 dark:bg-white/10 border border-gray-300/50 dark:border-white/20 text-black dark:text-white","aria-label":"Toggle menu",children:c?(0,s.jsx)(h.A,{className:"h-5 w-5"}):(0,s.jsx)(p.A,{className:"h-5 w-5"})})})]}),(0,s.jsx)(b.N,{children:c&&(0,s.jsx)(g.P.div,{ref:m,initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"md:hidden absolute top-16 right-4 z-40 mt-2 w-64 origin-top-right rounded-xl bg-white dark:bg-black shadow-lg ring-1 ring-black ring-opacity-5 dark:ring-white/10 focus:outline-none backdrop-blur-lg border border-gray-200 dark:border-gray-700/50",children:(0,s.jsxs)("div",{className:"py-2 px-2 space-y-1",children:[(0,s.jsx)("hr",{className:"border-gray-200 dark:border-gray-700/50 my-1"}),(0,s.jsxs)("button",{onClick:()=>u(()=>i(!0)),className:"w-full text-left px-3 py-2.5 rounded-lg text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 flex items-center gap-3 transition-colors",children:[(0,s.jsx)(y.A,{className:"h-4 w-4"}),"Logout"]})]})})}),(0,s.jsx)(b.N,{children:d&&(0,s.jsx)(g.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 dark:bg-black/80 backdrop-blur-sm p-4",onClick:()=>i(!1),children:(0,s.jsxs)(g.P.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",stiffness:300,damping:25},onClick:e=>e.stopPropagation(),className:"bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700/50 rounded-xl p-5 sm:p-6 w-full max-w-sm shadow-xl",children:[(0,s.jsx)("h3",{className:"text-black dark:text-white text-lg font-semibold mb-2",children:"Confirm Logout"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-5 text-sm",children:"Are you sure you want to logout?"}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:[(0,s.jsx)("button",{onClick:()=>i(!1),className:"w-full sm:w-auto flex-1 px-4 py-2.5 border border-gray-300 dark:border-gray-700 text-black dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-sm font-medium",children:"Cancel"}),(0,s.jsx)("button",{onClick:()=>{n(),i(!1)},className:"w-full sm:w-auto flex-1 px-4 py-2.5 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors text-sm font-medium",children:"Logout"})]})]})})})]})};var N=a(47924),k=a(55868),w=a(25305),S=a(81284),A=a(40646),C=a(54861),I=a(1243);function P(e){let{message:t,onDismiss:a}=e,[l,n]=(0,r.useState)(!1),[d,i]=(0,r.useState)("");if((0,r.useEffect)(()=>{t.message&&t.message!==d&&(n(!0),i(""))},[t,d]),!t.message||!l)return null;let c={container:"border-gray-200 bg-gray-50 text-gray-800 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-200",icon:"text-gray-500 dark:text-gray-400"},o=S.A;switch(t.type){case"success":c.container="border-green-200 bg-green-50 text-green-800 dark:border-green-800/30 dark:bg-green-900/20 dark:text-green-400",c.icon="text-green-500 dark:text-green-400",o=A.A;break;case"error":c.container="border-red-200 bg-red-50 text-red-800 dark:border-red-800/30 dark:bg-red-900/20 dark:text-red-400",c.icon="text-red-500 dark:text-red-400",o=C.A;break;case"info":c.container="border-blue-200 bg-blue-50 text-blue-800 dark:border-blue-800/30 dark:bg-blue-900/20 dark:text-blue-400",c.icon="text-blue-500 dark:text-blue-400",o=S.A;break;case"warning":c.container="border-yellow-200 bg-yellow-50 text-yellow-800 dark:border-yellow-800/30 dark:bg-yellow-900/20 dark:text-yellow-400",c.icon="text-yellow-500 dark:text-yellow-400",o=I.A}return(0,s.jsxs)("div",{className:"\n                flex items-center justify-between px-4 py-3 mb-4 rounded-lg border \n                shadow-sm transition-all duration-300 ease-in-out\n                ".concat(c.container," \n                ").concat(l?"opacity-100 transform translate-y-0":"opacity-0 transform -translate-y-2","\n            "),role:"alert",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"flex-shrink-0 mr-3 ".concat(c.icon),children:(0,s.jsx)(o,{size:18})}),(0,s.jsx)("div",{className:"flex-1 text-sm font-medium",children:t.message})]}),(0,s.jsx)("button",{onClick:()=>{n(!1),i(t.message),a&&a()},className:"ml-4 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,s.jsx)(h.A,{size:16})})]})}var D=a(60812);function E(e){let{selectedToken:t,isLoading:a,resultMessage:l,onSendPayment:n,onDismissResult:i}=e,[c,o]=(0,r.useState)(""),[m,x]=(0,r.useState)(""),[u,g]=(0,r.useState)(0),[b,y]=(0,r.useState)(!1),[h,p]=(0,r.useState)(""),[f,j]=(0,r.useState)(""),[v,S]=(0,r.useState)(""),[A,C]=(0,r.useState)(!1),[I,E]=(0,r.useState)([]),[F,_]=(0,r.useState)(!1),[R,T]=(0,r.useState)(""),[U,L]=(0,r.useState)(!1),z=(0,d.YL)(),J=null==z?void 0:z.address;(0,r.useEffect)(()=>{j("payment-".concat(Date.now(),"-").concat(Math.floor(1e6*Math.random())))},[]),(0,r.useEffect)(()=>{J&&M()},[J]),(0,r.useEffect)(()=>{C(a)},[a]),(0,r.useEffect)(()=>{(async()=>{try{let e=await (0,D.E)("SUI");g(e)}catch(e){console.error("Failed to fetch SUI exchange rate:",e),S("Could not fetch current SUI price. Using fallback rate.")}})()},[]),(0,r.useEffect)(()=>{(async()=>{if(!m||isNaN(parseFloat(m))||0>=parseFloat(m))return o("");y(!0);try{let e=u;e<=0&&(e=await (0,D.E)("SUI"),g(e));let t=parseFloat(m)*e;o(t.toFixed(6))}catch(e){console.error("Error converting USD to SUI:",e),S("Could not convert USD to SUI. Please try again.")}finally{y(!1)}})()},[m,u]);let M=async()=>{try{let e=await (0,w.QC)();E(e.data)}catch(e){console.error("Failed to load address book:",e)}},B=async e=>{if(T(e),e.length>0){L(!0);try{let t=await (0,w.vC)(e);E(t.data)}catch(e){console.error("Address search failed:",e)}finally{L(!1)}}else M()},Y=e=>{p(e.walletAddress),_(!1)},q=async()=>{if(!h||!c)return void S("Please provide both recipient and amount");S(""),C(!0);try{let e=h;if(!h.startsWith("0x"))try{e=await (0,w.S1)(h)}catch(e){S("Could not resolve nickname: ".concat(h)),C(!1);return}n(f,e,c)}catch(e){S("Payment failed: "+(e instanceof Error?e.message:String(e))),C(!1)}},O=a||A;return(0,s.jsx)("div",{className:"flex justify-center items-center",children:(0,s.jsxs)("div",{className:"max-w-4xl w-full space-y-6 backdrop-blur-sm p-8 rounded-lg",children:[(0,s.jsx)(P,{message:v?{type:"error",message:v}:l||{type:"",message:""},onDismiss:()=>{S(""),i&&i()}}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Recipient Address or Username"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"text",value:h,onChange:e=>{let t=e.target.value;p(t),t.length>2?(_(!0),B(t)):0===t.length&&_(!1)},onKeyPress:e=>{"Enter"===e.key&&(_(!0),B(h))},className:"w-full p-2 pr-10 bg-transparent border-b border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:outline-none text-gray-900 dark:text-white",placeholder:"wallet address or username",disabled:O}),(0,s.jsx)("button",{type:"button",onClick:()=>{_(!F),F||M()},className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300",disabled:O,children:(0,s.jsx)(N.A,{size:18})}),F&&(0,s.jsx)("div",{className:"absolute z-10 w-full mt-1 backdrop-blur-md bg-white/70 dark:bg-gray-800/70 rounded-md shadow-lg",children:(0,s.jsx)("div",{className:"max-h-48 overflow-y-auto",children:U?(0,s.jsx)("div",{className:"p-3 text-center text-gray-500 dark:text-gray-400",children:"Searching..."}):I.length>0?I.map(e=>(0,s.jsxs)("div",{className:"p-3 hover:bg-gray-100/80 dark:hover:bg-gray-700/80 cursor-pointer border-b border-gray-200/50 dark:border-gray-700/50",onClick:()=>Y(e),children:[(0,s.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:e.nickname}),(0,s.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:e.walletAddress})]},e._id)):(0,s.jsx)("div",{className:"p-3 text-center text-gray-500 dark:text-gray-400",children:R?"No contacts found":"Your address book is empty"})})})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Amount (USD)"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"absolute inset-y-0 left-0 flex items-center pl-2",children:(0,s.jsx)(k.A,{size:16,className:"text-gray-500 dark:text-gray-400"})}),(0,s.jsx)("input",{type:"text",value:m,onChange:e=>{let t=e.target.value;(""===t||/^\d*\.?\d*$/.test(t))&&x(t)},className:"w-full p-2 pl-8 bg-transparent border-b border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:outline-none text-gray-900 dark:text-white",placeholder:"0.00",disabled:O})]})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Equivalent in SUI"}),(0,s.jsx)("div",{className:"relative",children:b?(0,s.jsx)("div",{className:"w-full p-2 bg-transparent border-b border-gray-300 dark:border-gray-600 text-gray-500 dark:text-gray-400",children:"Converting..."}):(0,s.jsx)("div",{className:"w-full p-2 bg-transparent border-b border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white",children:c?"".concat(c," SUI"):"0.00 SUI"})}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Exchange Rate: 1 USD ≈ ",u>0?u.toFixed(6):"..."," SUI"]})]})]}),(0,s.jsx)("button",{type:"button",onClick:q,className:"w-full bg-gradient-to-r from-blue-600 to-blue-700 dark:from-blue-500 dark:to-blue-600 hover:from-blue-700 hover:to-blue-800 text-white py-3 rounded-md font-medium shadow-md transition-all duration-300 disabled:opacity-70 disabled:cursor-not-allowed",disabled:O||b||!c||!h,children:O?"Sending...":"Send ".concat(c?c+" SUI":"Payment")})]})})}function F(){return(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"font-medium",children:"Important:"})," Only payments with 'Sent' status can be claimed or reimbursed."]}),(0,s.jsxs)("ul",{className:"list-disc pl-5 text-sm",children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("span",{className:"font-medium text-blue-600",children:"Sent"})," - Payment is waiting to be claimed by recipient or reimbursed by sender"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("span",{className:"font-medium text-green-600",children:"Claimed"})," - Payment has already been claimed by the recipient"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("span",{className:"font-medium text-yellow-600",children:"Reimbursed"})," - Payment has been returned to the sender"]})]}),(0,s.jsxs)("div",{className:"mt-2 text-xs",children:[(0,s.jsx)("span",{className:"font-medium",children:"Note:"})," If a payment has already been claimed, it cannot be reimbursed. If it has been reimbursed, it cannot be claimed."]})]})}function _(e){let{onClick:t,isDisabled:a,actionType:r,buttonType:l,isLoading:n,title:d,label:i,activeColor:c}=e,o={"dark:bg-green-500 bg-green-300":{base:"bg-green-300 dark:bg-green-500",hover:"hover:bg-green-400 dark:hover:bg-green-600",active:"active:bg-green-500 dark:active:bg-green-700",shadow:"shadow-green-200/50 dark:shadow-green-900/20"},"dark:bg-yellow-500 bg-yellow-300":{base:"bg-yellow-300 dark:bg-yellow-500",hover:"hover:bg-yellow-400 dark:hover:bg-yellow-600",active:"active:bg-yellow-500 dark:active:bg-yellow-700",shadow:"shadow-yellow-200/50 dark:shadow-yellow-900/20"}}[c]||{base:"bg-gray-300 dark:bg-gray-600",hover:"hover:bg-gray-400 dark:hover:bg-gray-700",active:"active:bg-gray-500 dark:active:bg-gray-800",shadow:"shadow-gray-200/50 dark:shadow-gray-900/20"};return(0,s.jsxs)("button",{onClick:t,disabled:a,className:"\n                flex-1 relative py-3 px-6 rounded-lg font-medium text-sm\n                transition-all duration-200 ease-in-out\n                transform hover:scale-[1.02] active:scale-[0.98]\n                focus:outline-none focus:ring-2 focus:ring-opacity-50\n                \n                ".concat(r===l?"\n                    ".concat(o.base,"\n                    shadow-lg ").concat(o.shadow,"\n                    ").concat(o.hover,"\n                    ").concat(o.active,"\n                    focus:ring-opacity-50 focus:ring-green-400 dark:focus:ring-green-700\n                "):"\n                    bg-gray-200 dark:bg-gray-700\n                    hover:bg-gray-300 dark:hover:bg-gray-600\n                    shadow-md shadow-gray-200/30 dark:shadow-gray-900/10\n                    active:bg-gray-400 dark:active:bg-gray-800\n                    focus:ring-gray-400 dark:focus:ring-gray-500\n                ","\n                \n                disabled:opacity-60 disabled:cursor-not-allowed\n                disabled:shadow-none disabled:transform-none\n                disabled:bg-gray-200 dark:disabled:bg-gray-800\n                disabled:hover:scale-100\n                \n                text-gray-800 dark:text-white\n            "),title:d,children:[n?(0,s.jsxs)("div",{className:"flex items-center justify-center",children:[(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,s.jsx)("span",{children:"Processing..."})]}):(0,s.jsx)("span",{children:i}),!a&&(0,s.jsx)("span",{className:"absolute inset-0 rounded-lg opacity-20 bg-gradient-to-t from-black/5 to-white/20 pointer-events-none"})]})}function R(e){var t,a;let{isLoading:l,payments:n,onExecutePaymentAction:i,preselectedPaymentId:c="",preselectedAction:o,onClearAction:m}=e,x=(0,d.YL)(),[u,g]=(0,r.useState)(c),[b,y]=(0,r.useState)(o),[h,p]=(0,r.useState)({type:"",message:""});(0,r.useEffect)(()=>{g(c),y(o)},[c,o]);let f=e=>{i(u,e),y(e)},j=n.find(e=>e.parsedJson.payment_object_id===u);return(0,s.jsxs)("div",{children:[(0,s.jsx)(P,{message:h,onDismiss:()=>{p({type:"",message:""})}}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1 text-gray-900 dark:text-white",children:"Payment Object ID"}),(0,s.jsx)("input",{type:"text",value:u,onChange:e=>{g(e.target.value),y(null),e.target.value!==c&&m()},placeholder:"0x...",className:"bg-transparent w-full p-2 border-b border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:outline-none text-gray-900 dark:text-white"}),(0,s.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Enter the payment object ID you want to claim or reimburse"})]}),u&&(0,s.jsxs)("div",{className:"mb-4 p-3 bg-gray-50 dark:bg-gray-800/30 rounded-md",children:[(0,s.jsx)("h4",{className:"font-medium text-sm mb-2 text-gray-900 dark:text-white",children:"Payment Status Check"}),(0,s.jsx)(F,{}),j&&(0,s.jsxs)("div",{className:"mt-3 p-2 bg-white dark:bg-gray-800/50 border-b border-gray-300 dark:border-gray-700",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-900 dark:text-white",children:[(0,s.jsx)("strong",{children:"Payment ID:"})," ","string"==typeof j.parsedJson.payment_id?j.parsedJson.payment_id:new TextDecoder().decode(new Uint8Array(j.parsedJson.payment_id))]}),(0,s.jsxs)("div",{className:"text-sm text-gray-900 dark:text-white",children:[(0,s.jsx)("strong",{children:"Amount:"})," ",Number(j.parsedJson.amount)/1e9," SUI"]})]})]}),(0,s.jsx)("div",{className:"flex flex-row items-center justify-center",children:(0,s.jsxs)("div",{className:"w-auto space-x-3",children:[(0,s.jsx)(_,{onClick:()=>f("claim"),isDisabled:l||"reimburse"===b||!j||(null==(t=j.parsedJson.statusInfo)?void 0:t.status)!=="SENT"||j.parsedJson.from===(null==x?void 0:x.address),actionType:b,buttonType:"claim",isLoading:l,title:"Claim this payment to your wallet",label:"Claim Payment",activeColor:"dark:bg-green-500 bg-green-300"}),(0,s.jsx)(_,{onClick:()=>f("reimburse"),isDisabled:l||"claim"===b||!j||(null==(a=j.parsedJson.statusInfo)?void 0:a.status)!=="SENT"||j.parsedJson.from!==(null==x?void 0:x.address),actionType:b,buttonType:"reimburse",isLoading:l,title:"Return this payment to your wallet",label:"Reimburse Payment",activeColor:"dark:bg-yellow-500 bg-yellow-300"})]})})]})}function T(e){let{status:t}=e,a="bg-blue-100 text-blue-800",r="Pending";return"CLAIMED"===t?(a="bg-green-100 text-green-800",r="Claimed"):"REIMBURSED"===t&&(a="bg-yellow-100 text-yellow-800",r="Reimbursed"),(0,s.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat(a),children:r})}function U(e){var t,a;let{payment:r,currentUserAddress:l,selectedToken:n,onActionSelected:d}=e,i=r.parsedJson,c=i.from===l,o=i.to===l,m=(null==(t=i.statusInfo)?void 0:t.status)||"SENT",x=o&&"SENT"===m,u=c&&"SENT"===m,g="string"==typeof i.payment_id?i.payment_id:new TextDecoder().decode(new Uint8Array(i.payment_id));return(0,s.jsxs)("tr",{className:"border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-900/10",children:[(0,s.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-white",children:g}),(0,s.jsx)("td",{className:"px-4 py-2 text-sm",children:(0,s.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat(c?"bg-orange-100 text-orange-800":"bg-green-100 text-green-800"),children:c?"Sent":"Received"})}),(0,s.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-white",children:c?"To: ".concat(i.to.substring(0,8),"..."):"From: ".concat(i.from.substring(0,8),"...")}),(0,s.jsxs)("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-white",children:[Number(i.amount)/1e9," ",(null==n?void 0:n.symbol)||"SUI"]}),(0,s.jsxs)("td",{className:"px-4 py-2 text-sm",children:[(0,s.jsx)(T,{status:m}),(null==(a=i.statusInfo)?void 0:a.timestamp)&&(0,s.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:i.statusInfo.timestamp})]}),(0,s.jsxs)("td",{className:"px-4 py-2 text-sm",children:[(0,s.jsxs)("div",{className:"flex space-x-2",children:[x&&(0,s.jsx)("button",{onClick:()=>d(i.payment_object_id,"claim"),className:"px-3 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600",title:"Claim this payment to your wallet",children:"Claim"}),u&&(0,s.jsx)("button",{onClick:()=>d(i.payment_object_id,"reimburse"),className:"px-3 py-1 bg-yellow-500 text-white text-xs rounded hover:bg-yellow-600",title:"Return this payment to your wallet",children:"Reimburse"}),!x&&!u&&(0,s.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"CLAIMED"===m?"Payment claimed":"Payment reimbursed"})]}),(0,s.jsxs)("div",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:["ID: ",i.payment_object_id.substring(0,8),"..."]})]})]})}function L(e){let{payments:t,selectedToken:a,onActionSelected:r}=e,l=(0,d.YL)();return l?(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-medium mb-3 text-gray-900 dark:text-white",children:"Payment History"}),0===t.length?(0,s.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"No payments found."}):(0,s.jsx)("div",{className:"overflow-hidden",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Payment ID"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Direction"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Address"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Amount"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Status"}),(0,s.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Actions"})]})}),(0,s.jsx)("tbody",{children:t.map((e,t)=>(0,s.jsx)(U,{payment:e,currentUserAddress:l.address,selectedToken:a,onActionSelected:r},t))})]})})]}):(0,s.jsx)("div",{className:"text-gray-900 dark:text-white",children:"Please connect your wallet to view payment history."})}var z=a(49103),J=a(75525),M=a(28883),B=a(13717),Y=a(62525);function q(e){let{initialData:t=null,onSubmit:a,onCancel:l}=e,[n,d]=(0,r.useState)(""),[i,c]=(0,r.useState)(""),[o,m]=(0,r.useState)(""),[x,u]=(0,r.useState)({});(0,r.useEffect)(()=>{t&&(d(t.nickname),c(t.walletAddress),m(t.email||""))},[t]);let g=()=>{let e={};return n.trim()||(e.nickname="Nickname is required"),i.trim()||(e.walletAddress="Wallet address is required"),o&&!o.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)&&(e.email="Please enter a valid email address"),i&&!i.match(/^0x[a-fA-F0-9]{64}$/)&&(e.walletAddress="Invalid SUI wallet address format"),u(e),0===Object.keys(e).length};return(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),g()&&(a({nickname:n,walletAddress:i,email:o}),t||(d(""),c(""),m("")))},className:"border-b border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-transparent backdrop-blur-md",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"nickname",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Nickname"}),(0,s.jsx)("input",{id:"nickname",type:"text",value:n,onChange:e=>d(e.target.value),className:"w-full p-2 bg-transparent border-b focus:outline-none focus:border-blue-500 text-gray-900 dark:text-white ".concat(x.nickname?"border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"Enter a nickname"}),x.nickname&&(0,s.jsx)("p",{className:"text-red-500 text-xs mt-1",children:x.nickname})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"walletAddress",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Wallet Address"}),(0,s.jsx)("input",{id:"walletAddress",type:"text",value:i,onChange:e=>c(e.target.value),className:"w-full p-2 bg-transparent border-b focus:outline-none focus:border-blue-500 text-gray-900 dark:text-white ".concat(x.walletAddress?"border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"0x..."}),x.walletAddress&&(0,s.jsx)("p",{className:"text-red-500 text-xs mt-1",children:x.walletAddress})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Email Address"}),(0,s.jsx)("input",{id:"email",type:"email",value:o,onChange:e=>m(e.target.value),className:"w-full p-2 bg-transparent border-b focus:outline-none focus:border-blue-500 text-gray-900 dark:text-white ".concat(x.email?"border-red-500":"border-gray-300 dark:border-gray-600"),placeholder:"example@domain.com"}),x.email&&(0,s.jsx)("p",{className:"text-red-500 text-xs mt-1",children:x.email})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 mt-6",children:[(0,s.jsx)("button",{type:"button",onClick:l,className:"px-4 py-2 border-b border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-100/20 dark:hover:bg-gray-700/20",children:"Cancel"}),(0,s.jsx)("button",{type:"submit",className:"px-4 py-2 bg-gradient-to-r from-blue-600 to-blue-700 dark:from-blue-500 dark:to-blue-600 hover:from-blue-700 hover:to-blue-800 text-white rounded-md shadow-sm",children:t?"Update":"Save"})]})]})}function O(){let[e,t]=(0,r.useState)([]),[a,l]=(0,r.useState)(!1),[i,c]=(0,r.useState)(""),[o,m]=(0,r.useState)(!1),[x,u]=(0,r.useState)(null),g=(0,d.YL)(),b=null==g?void 0:g.address;(0,r.useEffect)(()=>{b&&y()},[b]);let y=async()=>{l(!0);try{let e=await (0,w.QC)();t(e.data)}catch(e){console.error("Failed to fetch addresses:",e),n.oR.error("Failed to load address book")}finally{l(!1)}},h=async e=>{let a=e.target.value;if(c(a),a.length>0){l(!0);try{let e=await (0,w.vC)(a);t(e.data)}catch(e){console.error("Search failed:",e),n.oR.error("Search failed. Please try again.")}finally{l(!1)}}else y()},p=async e=>{try{await (0,w.E1)(e.nickname,e.walletAddress,e.email),m(!1),n.oR.success("Contact added successfully"),y()}catch(e){var t,a;console.error("Failed to add address:",e),n.oR.error((null==(a=e.response)||null==(t=a.data)?void 0:t.message)||"Failed to add contact")}},f=async e=>{try{if(!x)return;let t={...e.walletAddress!==x.walletAddress?{walletAddress:e.walletAddress}:{},...e.nickname!==x.nickname?{newNickname:e.nickname}:{},...e.email!==x.email?{email:e.email}:{}};await (0,w.yU)(x.nickname,t),u(null),n.oR.success("Contact updated successfully"),y()}catch(e){var t,a;console.error("Failed to update address:",e),n.oR.error((null==(a=e.response)||null==(t=a.data)?void 0:t.message)||"Failed to update contact")}},[j,v]=(0,r.useState)(!1),[k,S]=(0,r.useState)(""),A=e=>{S(e),v(!0)},C=async()=>{try{await (0,w.ab)(k),n.oR.success("Contact deleted successfully"),y()}catch(e){console.error("Failed to delete address:",e),n.oR.error("Failed to delete contact")}finally{v(!1)}};return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"Address Book"}),(0,s.jsxs)("button",{onClick:()=>m(!o),className:"flex items-center gap-1 bg-blue-600 dark:bg-blue-500 hover:bg-blue-700 dark:hover:bg-blue-600 text-white px-3 py-2 rounded-md",children:[(0,s.jsx)(z.A,{size:16}),(0,s.jsx)("span",{children:"Add Contact"})]})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(N.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-400",size:18}),(0,s.jsx)("input",{type:"text",placeholder:"Search contacts...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-transparent text-gray-900 dark:text-white",value:i,onChange:h})]}),o&&(0,s.jsx)(q,{onSubmit:p,onCancel:()=>m(!1)}),x&&(0,s.jsx)(q,{initialData:x,onSubmit:f,onCancel:()=>u(null)}),(0,s.jsx)("div",{className:"mt-4",children:a?(0,s.jsx)("div",{className:"flex justify-center py-8",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"})}):e.length>0?(0,s.jsx)("div",{className:"grid gap-2",children:e.map(e=>(0,s.jsxs)("div",{className:"flex justify-between items-center p-3 border border-gray-200 dark:border-gray-700 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("h3",{className:"font-medium text-gray-900 dark:text-white",children:e.nickname}),e.isVerifiedUser&&(0,s.jsx)(J.A,{size:16,className:"ml-2 text-green-500"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 break-all",children:e.walletAddress}),e.email&&(0,s.jsxs)("div",{className:"flex items-center mt-1 text-xs text-gray-500 dark:text-gray-400",children:[(0,s.jsx)(M.A,{size:12,className:"mr-1"}),(0,s.jsx)("span",{children:e.email})]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>u(e),className:"p-1 text-gray-500 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400",children:(0,s.jsx)(B.A,{size:18})}),(0,s.jsx)("button",{onClick:()=>A(e.nickname),className:"p-1 text-gray-500 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-400",children:(0,s.jsx)(Y.A,{size:18})})]})]},e._id))}):(0,s.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:i?"No contacts found":"Your address book is empty"})}),j&&(0,s.jsx)("div",{className:"fixed inset-0 bg-transparent bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-transparent opacity-90 backdrop-blur-3xl p-6 rounded-lg shadow-lg max-w-sm w-full",children:[(0,s.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Confirm Deletion"}),(0,s.jsxs)("p",{className:"mb-6",children:["Are you sure you want to delete ",k,"?"]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,s.jsx)("button",{onClick:()=>v(!1),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700",children:"Cancel"}),(0,s.jsx)("button",{onClick:C,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Delete"})]})]})})]})}function W(e){let{selectedToken:t}=e,[a,l]=(0,r.useState)("send"),[n,d]=(0,r.useState)(""),[i,c]=(0,r.useState)(null),{payments:o,isLoading:m,resultMessage:u,setResultMessage:g,sendPayment:b,executePaymentAction:y}=x(t),h=()=>{d(""),c(null)};return(0,s.jsxs)("div",{className:"mt-8 min-w-[70vw] bg-transparent rounded-xl overflow-hidden",children:[(0,s.jsx)("div",{className:"flex border-b border-gray-200 dark:border-gray-800 mb-4",children:[{id:"send",label:"Send Payment"},{id:"claim",label:"Claim/Reimburse"},{id:"history",label:"Payment History"},{id:"addressBook",label:"Address Book"}].map(e=>(0,s.jsx)("button",{onClick:()=>{l(e.id),h()},className:"px-4 py-3 text-sm font-medium ".concat(a===e.id?"text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400":"text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300"),children:e.label},e.id))}),(0,s.jsxs)("div",{className:"p-4",children:["send"===a&&(0,s.jsx)(E,{selectedToken:t,isLoading:m,resultMessage:u,onSendPayment:b,onDismissResult:()=>{g({type:"",message:""})}}),"claim"===a&&(0,s.jsx)(R,{isLoading:m,payments:o,onExecutePaymentAction:y,preselectedPaymentId:n,preselectedAction:i,onClearAction:h}),"history"===a&&(0,s.jsx)(L,{payments:o,selectedToken:t,onActionSelected:(e,t)=>{d(e),c(t),l("claim")}}),"addressBook"===a&&(0,s.jsx)(O,{})]})]})}var H=a(74228);let V=async(e,t,a)=>{let s=await H.A.post("/split-bill",{invoiceId:e,initiatorWalletAddress:t,participants:a}),r=s.data.data;return await c.L.storeAuditRecord({recordType:"splitBill",recordId:r._id,timestamp:Date.now(),walletAddresses:[t,...r.participants.map(e=>e.walletAddress)],amounts:[r.totalAmount||0],totalAmount:r.totalAmount||0,chain:"SUI",status:"created"}),s.data},Q=async()=>(await H.A.get("/split-bill/initiated")).data,Z=async()=>(await H.A.get("/split-bill/participating")).data,$=async(e,t,a)=>{let s=await H.A.patch("/split-bill/".concat(e,"/participant/").concat(t),{transactionHash:a}),r=s.data.data,l=r.participants.find(e=>e.email===t);return l&&await c.L.storeAuditRecord({recordType:"splitBill",recordId:r._id,timestamp:Date.now(),walletAddresses:[l.walletAddress],amounts:[l.amount||0],totalAmount:l.amount||0,chain:"SUI",status:"participant_paid",transactionHash:a}),s.data};var G=a(14186),K=a(17580),X=a(85339);let ee=e=>{let{selectedToken:t,refreshTrigger:a=0}=e,[l,c]=(0,r.useState)([]),[o,m]=(0,r.useState)([]),[u,g]=(0,r.useState)("initiated"),[b,y]=(0,r.useState)(!0),[p,j]=(0,r.useState)(null),[v,N]=(0,r.useState)(null),[k,w]=(0,r.useState)(!1),S=(0,d.YL)(),{user:C}=(0,f.A)(),{currentNetwork:I}=(0,i.h)(),{sendPayment:P,isLoading:D,resultMessage:E,setResultMessage:F}=x(t);(0,r.useEffect)(()=>{(async()=>{if(C){y(!0);try{let e=await Q();c(e.data);let t=await Z();m(t.data)}catch(e){console.error("Failed to fetch split bills:",e),n.oR.error("Failed to load your split bills")}finally{y(!1)}}})()},[a,C]);let _=e=>(null==S?void 0:S.address)&&(null==C?void 0:C.email)?e.participants.find(e=>e.email===C.email||e.walletAddress===S.address):null,R=e=>{j(e)},T=e=>{N(e),w(!0)},U=async()=>{if(!v||!(null==S?void 0:S.address)||!C)return;let e=_(v);if(!e)return void n.oR.error("Could not find your payment details");if("paid"===e.status){(0,n.oR)("You have already paid your share"),w(!1);return}let t="SPLIT-PAY-".concat(Date.now(),"-").concat(Math.floor(1e6*Math.random()));F({type:"",message:""});try{await P(t,v.initiatorWalletAddress,e.amount.toString())}catch(e){console.error("Payment failed:",e),n.oR.error("Failed to make payment")}};(0,r.useEffect)(()=>{if(v&&"success"===E.type&&E.message.includes("digest")&&(null==C?void 0:C.email)){let e=E.message.split("digest: ")[1];(async()=>{try{await $(v.splitId,C.email,e);let t=await Z();m(t.data),n.oR.success("Your payment has been recorded"),setTimeout(()=>{w(!1),N(null)},2e3)}catch(e){console.error("Failed to update payment status:",e),n.oR.error("Payment was sent but failed to update status")}})()}},[E,v,null==C?void 0:C.email]);let L=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),z=e=>{switch(e.status){case"active":return(0,s.jsx)(G.A,{className:"h-5 w-5 text-yellow-500"});case"completed":return(0,s.jsx)(A.A,{className:"h-5 w-5 text-green-500"});case"cancelled":return(0,s.jsx)(h.A,{className:"h-5 w-5 text-red-500"});default:return null}};if(!C)return(0,s.jsx)("div",{className:"text-center py-8 border border-gray-200 dark:border-gray-700 rounded-md",children:"Please sign in to view your split bills"});if(b)return(0,s.jsx)("div",{className:"flex justify-center items-center p-8",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"})});let J="initiated"===u?l:o;return(0,s.jsxs)("div",{className:"mt-4 w-full",children:[(0,s.jsxs)("div",{className:"flex border-b border-gray-200 dark:border-gray-700 mb-4",children:[(0,s.jsx)("button",{className:"px-4 py-2 font-medium text-sm ".concat("initiated"===u?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 dark:text-gray-400"),onClick:()=>g("initiated"),children:"Splits You Created"}),(0,s.jsx)("button",{className:"px-4 py-2 font-medium text-sm ".concat("participating"===u?"border-b-2 border-blue-500 text-blue-600 dark:text-blue-400":"text-gray-500 dark:text-gray-400"),onClick:()=>g("participating"),children:"Splits to Pay"})]}),0===J.length?(0,s.jsx)("div",{className:"text-center py-8 border border-gray-200 dark:border-gray-700 rounded-md",children:"No split bills found"}):(0,s.jsx)("div",{className:"space-y-4",children:J.map(e=>(0,s.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("h3",{className:"font-medium text-lg",children:["Split ",e.splitId]}),(0,s.jsx)("div",{className:"ml-2",children:z(e)})]}),(0,s.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["For invoice ",e.invoiceNumber]}),(0,s.jsxs)("p",{className:"text-sm mt-1",children:[(0,s.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:"Total: "}),(0,s.jsxs)("span",{className:"font-medium",children:[e.totalAmount," SUI"]})]}),(0,s.jsxs)("p",{className:"text-sm",children:[(0,s.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:"Due: "}),(0,s.jsx)("span",{className:"font-medium",children:L(e.dueDate)})]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsx)("button",{onClick:()=>R(e),className:"text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:"View Details"}),"participating"===u&&(()=>{let t=_(e);return t?"paid"===t.status?(0,s.jsxs)("span",{className:"text-sm text-green-600 dark:text-green-500 flex items-center",children:[(0,s.jsx)(A.A,{className:"h-4 w-4 mr-1"}),"Paid"]}):"active"===e.status?(0,s.jsxs)("button",{onClick:()=>T(e),className:"px-3 py-1 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-md",children:["Pay ",t.amount," SUI"]}):null:null})()]})]}),(0,s.jsx)("div",{className:"mt-3",children:(0,s.jsxs)("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[(0,s.jsx)(K.A,{className:"h-4 w-4 mr-1"}),(0,s.jsxs)("span",{children:[e.participants.filter(e=>"paid"===e.status).length," of ",e.participants.length," paid"]})]})})]},e._id))}),p&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-2xl w-full",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h3",{className:"text-xl font-bold",children:"Split Details"}),(0,s.jsx)("button",{onClick:()=>j(null),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,s.jsx)(h.A,{size:20})})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Split ID"}),(0,s.jsx)("p",{className:"font-medium",children:p.splitId})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Invoice"}),(0,s.jsx)("p",{className:"font-medium",children:p.invoiceNumber})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Amount"}),(0,s.jsxs)("p",{className:"font-medium",children:[p.totalAmount," SUI"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Due Date"}),(0,s.jsx)("p",{className:"font-medium",children:L(p.dueDate)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Status"}),(0,s.jsxs)("div",{className:"flex items-center",children:[z(p),(0,s.jsx)("span",{className:"ml-2 capitalize",children:p.status})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Created"}),(0,s.jsx)("p",{className:"font-medium",children:L(p.createdAt)})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium mb-2",children:"Participants"}),(0,s.jsx)("div",{className:"divide-y divide-gray-200 dark:divide-gray-700 border border-gray-200 dark:border-gray-700 rounded-md",children:p.participants.map((e,t)=>(0,s.jsxs)("div",{className:"flex justify-between items-center p-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:e.nickname}),(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.email})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("p",{className:"font-medium",children:[e.amount," SUI"]}),(0,s.jsx)("p",{className:"text-sm ".concat("paid"===e.status?"text-green-600 dark:text-green-500":"text-yellow-600 dark:text-yellow-500"),children:"paid"===e.status?(0,s.jsxs)("span",{className:"flex items-center justify-end",children:[(0,s.jsx)(A.A,{className:"h-3 w-3 mr-1"}),"Paid on ",L(e.paymentDate||"")]}):(0,s.jsx)("span",{children:"Pending"})})]})]},t))})]}),"completed"===p.status&&p.completedDate&&(0,s.jsx)("div",{className:"bg-green-100 dark:bg-green-900/30 border border-green-300 dark:border-green-700 rounded-md p-3",children:(0,s.jsxs)("p",{className:"text-green-700 dark:text-green-400 flex items-center",children:[(0,s.jsx)(A.A,{className:"h-4 w-4 mr-2"}),"All participants have paid. Split completed on ",L(p.completedDate)]})})]}),(0,s.jsx)("div",{className:"mt-6 flex justify-end",children:(0,s.jsx)("button",{onClick:()=>j(null),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600",children:"Close"})})]})}),k&&v&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-md w-full",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h3",{className:"text-xl font-bold",children:"Pay Your Share"}),!D&&(0,s.jsx)("button",{onClick:()=>w(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,s.jsx)(h.A,{size:20})})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"p-4 bg-gray-50 dark:bg-gray-900 rounded-md",children:[(0,s.jsxs)("p",{className:"font-medium",children:["Split ID: ",v.splitId]}),(0,s.jsxs)("p",{className:"text-sm mt-1",children:["Invoice: ",v.invoiceNumber]}),(0,s.jsxs)("p",{className:"text-sm mt-1",children:["Due: ",L(v.dueDate)]})]}),(()=>{let e=_(v);return e?(0,s.jsxs)("div",{className:"p-4 border border-blue-100 dark:border-blue-900 rounded-md",children:[(0,s.jsxs)("p",{className:"font-medium",children:["Your share: ",e.amount," SUI"]}),(0,s.jsxs)("p",{className:"text-sm mt-1",children:["Paying to: ",v.initiatorWalletAddress.substring(0,8),"..."]})]}):null})(),D&&(0,s.jsx)("div",{className:"bg-blue-100 dark:bg-blue-900/30 border border-blue-300 dark:border-blue-700 rounded-md p-4 my-4",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-blue-500 mr-3"}),(0,s.jsx)("span",{className:"text-blue-700 dark:text-blue-400",children:"Processing your payment..."})]})}),"success"===E.type&&(0,s.jsx)("div",{className:"bg-green-100 dark:bg-green-900/30 border border-green-300 dark:border-green-700 rounded-md p-4 my-4",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(A.A,{className:"h-5 w-5 text-green-500 mr-3"}),(0,s.jsx)("span",{className:"text-green-700 dark:text-green-400",children:E.message})]})}),"error"===E.type&&(0,s.jsx)("div",{className:"bg-red-100 dark:bg-red-900/30 border border-red-300 dark:border-red-700 rounded-md p-4 my-4",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(X.A,{className:"h-5 w-5 text-red-500 mr-3"}),(0,s.jsx)("span",{className:"text-red-700 dark:text-red-400",children:E.message})]})})]}),(0,s.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,s.jsx)("button",{onClick:()=>w(!1),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700",disabled:D,children:"Cancel"}),(0,s.jsx)("button",{onClick:U,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed",disabled:D||"success"===E.type,children:D?(0,s.jsxs)("span",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}),"Processing..."]}):"Confirm Payment"})]})]})})]})},et=async e=>(await H.A.get("/invoices/client-invoices?email=".concat(encodeURIComponent(e)))).data,ea=async e=>{let t=await H.A.post("/invoices",e);return await c.L.storeAuditRecord({recordType:"invoice",recordId:t.data.data._id,timestamp:Date.now(),walletAddresses:[e.walletAddress||""],amounts:[e.amount||0],totalAmount:e.amount||0,chain:"SUI",status:"created"}),t.data},es=async(e,t,a)=>{let s=await H.A.patch("/invoices/".concat(e,"/payment"),{paymentStatus:t,transactionHash:a}),r=s.data.data;return await c.L.storeAuditRecord({recordType:"invoice",recordId:e,timestamp:Date.now(),walletAddresses:[r.walletAddress],amounts:[r.amount],totalAmount:r.amount,chain:"SUI",status:t,transactionHash:a}),s.data};var er=a(94631),el=a(84616),en=a(87712);let ed=e=>{let{invoice:t,onClose:a,onSuccess:l}=e,[i,c]=(0,r.useState)([]),[o,m]=(0,r.useState)(!0),[x,u]=(0,r.useState)([]),[g,b]=(0,r.useState)(t.amount),[y,p]=(0,r.useState)(""),[f,j]=(0,r.useState)(!1),v=(0,d.YL)(),N=(null==v?void 0:v.address)||"";(0,r.useEffect)(()=>{(async()=>{m(!0);try{let e=await (0,w.QC)();c(e.data)}catch(e){console.error("Failed to load contacts:",e),n.oR.error("Failed to load your contacts"),p("Could not load your contacts. Please try again.")}finally{m(!1)}})()},[]),(0,r.useEffect)(()=>{let e=x.reduce((e,t)=>e+t.amount,0);b(parseFloat((t.amount-e).toFixed(8)))},[x,t.amount]);let k=e=>{u(x.filter((t,a)=>a!==e))},S=(e,t)=>{let a=[...x];a[e].amount=t,u(a)},A=(e,t)=>{let a=[...x];a[e].nickname=t,u(a)},C=async()=>{if(0===x.length)return void p("Add at least one friend to split the bill with.");if(Math.abs(g)>1e-6)return void p("The total split amount must equal the invoice amount.");if(!N)return void p("Your wallet address is required to create a split.");j(!0),p("");try{await V(t._id,N,x),n.oR.success("Split bill created successfully!"),l(),a()}catch(t){var e,s;console.error("Failed to create split bill:",t),p((null==(s=t.response)||null==(e=s.data)?void 0:e.message)||"Failed to create split bill. Please try again."),n.oR.error("Failed to create split bill")}finally{j(!1)}};return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-2xl w-full",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("h3",{className:"text-xl font-bold",children:["Split Invoice ",t.invoiceNumber]}),(0,s.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",disabled:f,children:(0,s.jsx)(h.A,{size:20})})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Invoice Amount"}),(0,s.jsxs)("p",{className:"font-medium text-lg",children:[t.amount," SUI"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Due Date"}),(0,s.jsx)("p",{className:"font-medium",children:new Date(t.dueDate).toLocaleDateString()})]})]}),y&&(0,s.jsx)("div",{className:"bg-red-100 dark:bg-red-900/30 border border-red-300 dark:border-red-700 rounded-md p-3 mb-4",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(I.A,{className:"h-5 w-5 text-red-500 mr-2"}),(0,s.jsx)("span",{className:"text-red-700 dark:text-red-400 text-sm",children:y})]})}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(K.A,{className:"h-5 w-5 mr-2"}),(0,s.jsx)("h4",{className:"font-medium",children:"Friends to Split With"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("button",{type:"button",onClick:()=>{if(0===x.length)return void p("Add friends first to split evenly.");let e=parseFloat((t.amount/x.length).toFixed(8));u(x.map(t=>({...t,amount:e})))},className:"text-sm text-blue-600 dark:text-blue-400 hover:underline mr-4",disabled:0===x.length||f,children:"Split Evenly"}),(0,s.jsxs)("button",{type:"button",onClick:()=>{if(0===i.length)return void p("No contacts available in your address book.");let e=i.filter(e=>!x.some(t=>t.nickname===e.nickname));if(0===e.length)return void p("All your contacts have been added already.");let t=parseFloat((g/(x.length+1)).toFixed(8));u([...x,{nickname:e[0].nickname,amount:t}])},className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-1 px-3 rounded text-sm",disabled:o||f,children:[(0,s.jsx)(el.A,{size:14,className:"inline mr-1"}),"Add Friend"]})]})]}),o?(0,s.jsx)("div",{className:"text-center py-4",children:"Loading contacts..."}):(0,s.jsxs)("div",{children:[0===x.length?(0,s.jsx)("div",{className:"text-center py-4 border border-dashed border-gray-300 dark:border-gray-600 rounded-md",children:'Click "Add Friend" to start splitting'}):(0,s.jsx)("div",{className:"space-y-3",children:x.map((e,a)=>(0,s.jsxs)("div",{className:"flex items-center gap-3 p-3 border border-gray-200 dark:border-gray-700 rounded-md",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)("select",{value:e.nickname,onChange:e=>A(a,e.target.value),className:"w-full bg-transparent border-b border-gray-300 dark:border-gray-600 py-1 focus:outline-none",disabled:f,children:i.map(e=>(0,s.jsx)("option",{value:e.nickname,disabled:x.some((t,s)=>s!==a&&t.nickname===e.nickname),children:e.nickname},e._id))})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("input",{type:"number",value:e.amount,onChange:e=>S(a,parseFloat(e.target.value)||0),step:"0.00000001",min:"0.00000001",max:t.amount.toString(),className:"w-24 bg-transparent border-b border-gray-300 dark:border-gray-600 py-1 text-right focus:outline-none",disabled:f}),(0,s.jsx)("span",{className:"ml-1",children:"SUI"})]}),(0,s.jsx)("button",{type:"button",onClick:()=>k(a),className:"text-red-500 hover:text-red-700 dark:hover:text-red-400",disabled:f,children:(0,s.jsx)(en.A,{size:18})})]},a))}),(0,s.jsxs)("div",{className:"flex justify-between mt-4 text-sm",children:[(0,s.jsx)("span",{className:"font-medium",children:"Remaining to be split:"}),(0,s.jsxs)("span",{className:"font-medium ".concat(1e-6>Math.abs(g)?"text-green-600 dark:text-green-500":"text-yellow-600 dark:text-yellow-500"),children:[g.toFixed(8)," SUI"]})]})]})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3 mt-6",children:[(0,s.jsx)("button",{type:"button",onClick:a,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700",disabled:f,children:"Cancel"}),(0,s.jsx)("button",{type:"button",onClick:C,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed",disabled:f||o||0===x.length||Math.abs(g)>1e-6,children:f?"Creating...":"Create Split Bill"})]})]})})},ei=e=>{let{selectedToken:t}=e,[a,l]=(0,r.useState)([]),[d,c]=(0,r.useState)(!0),[o,m]=(0,r.useState)(null),[u,g]=(0,r.useState)(!1),[b,y]=(0,r.useState)(!1),[p,j]=(0,r.useState)(""),[v,N]=(0,r.useState)(0),[w,S]=(0,r.useState)(""),[C,I]=(0,r.useState)(""),[P,E]=(0,r.useState)(!1),[F,_]=(0,r.useState)(null),[R,T]=(0,r.useState)(0),[U,L]=(0,r.useState)(!1),{user:z}=(0,f.A)(),{currentNetwork:J}=(0,i.h)(),{sendPayment:M,isLoading:B,resultMessage:Y,fetchUserCoins:q,coinObjects:O,setResultMessage:W}=x(t);(0,r.useEffect)(()=>()=>{W({type:"",message:""}),j("")},[W]),(0,r.useEffect)(()=>{(async()=>{try{let e=await (0,D.E)("SUI");N(e)}catch(e){console.error("Failed to fetch SUI exchange rate:",e)}})()},[]),(0,r.useEffect)(()=>{if(o&&v>0){let e=parseFloat(o.amount.toString());I((e*v).toFixed(6)),S(e.toFixed(2))}else I(""),S("")},[o,v]),(0,r.useEffect)(()=>{if(b&&Y.type&&o)if("success"===Y.type&&Y.message.includes("digest")){let e=Y.message.split("digest: ")[1];es(o._id,"paid",e).then(()=>{l(a.map(t=>t._id===o._id?{...t,paymentStatus:"paid",transactionHash:e}:t)),U||(n.oR.success("Invoice paid successfully!"),L(!0)),setTimeout(()=>{g(!1),m(null),y(!1)},2e3)}).catch(e=>{console.error("Failed to update invoice status:",e),U||(n.oR.error("Payment was successful, but failed to update invoice status"),L(!0)),y(!1),j("Payment successful but invoice update failed. Please contact support.")})}else"error"===Y.type&&(j("Payment failed: ".concat(Y.message)),y(!1))},[Y,b,o,a,U]),(0,r.useEffect)(()=>{(async()=>{if(null==z?void 0:z.email)try{c(!0);let e=await et(z.email);l(e.data)}catch(e){n.oR.error("Failed to fetch invoices"),console.error(e)}finally{c(!1)}})()},[null==z?void 0:z.email]);let H=e=>{m(e),g(!0),j(""),L(!1)},V=e=>{_(e),E(!0)},Q=(0,r.useCallback)(e=>!!O&&0!==O.length&&O.reduce((e,t)=>e+Number(t.balance),0)>=Math.floor(1e9*parseFloat(e)),[O]),Z=async()=>{if(!o||!C)return;if(!Q(C))return void j("Insufficient funds to pay this invoice (".concat(C," SUI)"));let e="INV-".concat(o._id,"-").concat(Date.now());W({type:"",message:""}),j(""),y(!0);try{await M(e,o.walletAddress,C),q()}catch(e){console.error("Payment failed:",e),j("Failed to initiate payment"),y(!1)}},$=e=>{switch(e){case"pending":return(0,s.jsx)(G.A,{className:"h-5 w-5 text-yellow-500"});case"paid":return(0,s.jsx)(A.A,{className:"h-5 w-5 text-green-500"});case"cancelled":return(0,s.jsx)(h.A,{className:"h-5 w-5 text-red-500"});default:return null}};return d?(0,s.jsx)("div",{className:"flex justify-center items-center p-8",children:(0,s.jsx)(er.A,{className:"animate-spin h-8 w-8"})}):(0,s.jsxs)("div",{className:"mt-4 w-full",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Your Invoices"}),0===a.length?(0,s.jsx)("div",{className:"text-center py-8 border border-gray-200 dark:border-gray-700 rounded-md",children:"No invoices found"}):(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Invoice #"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"From"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Amount"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Due Date"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Action"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:a.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.invoiceNumber}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.createdBy}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.amount," ",(null==t?void 0:t.symbol)||"SUI"]}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:new Date(e.dueDate).toLocaleDateString()}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap flex items-center",children:[$(e.paymentStatus),(0,s.jsx)("span",{className:"ml-2",children:e.paymentStatus})]}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:["pending"===e.paymentStatus&&(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("button",{onClick:()=>H(e),className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-1 px-3 rounded",disabled:!e.walletAddress,children:"Pay"}),(0,s.jsxs)("button",{onClick:()=>V(e),className:"border border-blue-600 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 font-medium py-1 px-3 rounded flex items-center",children:[(0,s.jsx)(K.A,{size:16,className:"mr-1"}),"Split"]})]}),"paid"===e.paymentStatus&&e.transactionHash&&(0,s.jsx)("a",{href:"https://suiscan.xyz/".concat(J,"/tx/").concat(e.transactionHash),target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:"View Transaction"})]})]},e._id))})]})}),u&&o&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-xl w-full",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("h3",{className:"text-xl font-bold",children:["Pay Invoice ",o.invoiceNumber]}),!b&&!B&&(0,s.jsx)("button",{onClick:()=>g(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,s.jsx)(h.A,{size:20})})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"p-4 bg-gray-50 dark:bg-gray-900 rounded-md",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"From"}),(0,s.jsx)("p",{className:"font-medium",children:o.createdBy})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Due Date"}),(0,s.jsx)("p",{className:"font-medium",children:new Date(o.dueDate).toLocaleDateString()})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Network"}),(0,s.jsx)("p",{className:"font-medium capitalize",children:J})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Status"}),(0,s.jsxs)("div",{className:"font-medium flex items-center",children:[$(o.paymentStatus),(0,s.jsx)("span",{className:"ml-2 capitalize",children:o.paymentStatus})]})]})]}),o.description&&(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Description"}),(0,s.jsx)("p",{className:"font-medium",children:o.description})]})]}),(0,s.jsx)("div",{className:"p-4 border border-blue-100 dark:border-blue-900 rounded-md",children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:"USD Amount:"}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(k.A,{size:16,className:"text-gray-400 mr-1"}),(0,s.jsx)("span",{className:"text-lg font-bold",children:o.amount})]})]}),v>0&&C&&(0,s.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,s.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:"SUI to Pay:"}),(0,s.jsxs)("span",{className:"text-lg font-bold",children:[C," ",(null==t?void 0:t.symbol)||"SUI"]})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 mt-2",children:["Exchange Rate: 1 USD = ",v>0?v.toFixed(6):"..."," SUI"]})]})}),(0,s.jsxs)("div",{className:"p-4 border border-gray-200 dark:border-gray-700 rounded-md",children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Recipient Address"}),(0,s.jsx)("p",{className:"font-mono text-sm break-all mt-1",children:o.walletAddress})]}),p?(0,s.jsx)("div",{className:"bg-red-100 dark:bg-red-900/30 border border-red-300 dark:border-red-700 rounded-md p-4 my-4",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(X.A,{className:"h-5 w-5 text-red-500 mr-3"}),(0,s.jsx)("span",{className:"text-red-700 dark:text-red-400",children:p})]})}):b||B?(0,s.jsx)("div",{className:"bg-blue-100 dark:bg-blue-900/30 border border-blue-300 dark:border-blue-700 rounded-md p-4 my-4",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(er.A,{className:"h-5 w-5 text-blue-500 mr-3 animate-spin"}),(0,s.jsx)("span",{className:"text-blue-700 dark:text-blue-400",children:Y.message||"Processing your payment..."})]})}):"success"===Y.type?(0,s.jsx)("div",{className:"bg-green-100 dark:bg-green-900/30 border border-green-300 dark:border-green-700 rounded-md p-4 my-4",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(A.A,{className:"h-5 w-5 text-green-500 mr-3"}),(0,s.jsx)("span",{className:"text-green-700 dark:text-green-400",children:Y.message})]})}):null]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-4 mt-6",children:[!Y.type&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>g(!1),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700",disabled:B||b,children:"Cancel"}),(0,s.jsx)("button",{onClick:Z,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed transition-colors",disabled:B||b||!Q(C),children:B||b?(0,s.jsxs)("span",{className:"flex items-center",children:[(0,s.jsx)(er.A,{className:"animate-spin mr-2 h-4 w-4"}),"Processing..."]}):"Pay ".concat(C," ").concat((null==t?void 0:t.symbol)||"SUI"," (").concat(o.amount," USD)")})]}),"success"===Y.type&&(0,s.jsx)("button",{onClick:()=>g(!1),className:"px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"Close"})]}),o&&!Q(C)&&(0,s.jsxs)("div",{className:"mt-4 text-sm text-red-600 dark:text-red-400",children:[(0,s.jsx)(X.A,{className:"inline h-4 w-4 mr-1"}),"Insufficient funds to complete this payment"]})]})}),P&&F&&(0,s.jsx)(ed,{invoice:F,onClose:()=>E(!1),onSuccess:()=>{T(e=>e+1),n.oR.success("Invoice split successfully!")}})]})},ec=()=>{let{user:e}=(0,f.A)(),[t,a]=(0,r.useState)({clientName:"",clientEmail:"",dueDate:"",description:"",amount:"",walletAddress:""}),[l,d]=(0,r.useState)(!1),[i,c]=(0,r.useState)(!0),o=e=>{let{name:t,value:s}=e.target;a(e=>({...e,[t]:s}))},m=async e=>{if(e.preventDefault(),!t.clientEmail||!t.amount||!t.dueDate)return void n.oR.error("Please fill in all required fields");try{var s;d(!0);let e=await ea({...t,amount:parseFloat(t.amount)});if(i&&(null==(s=e.data)?void 0:s._id))try{await (0,w.VR)(e.data._id),n.oR.success("Invoice created and contact added to address book")}catch(e){console.error("Failed to add contact to address book:",e),n.oR.success("Invoice created, but failed to add contact")}else n.oR.success("Invoice created successfully");a({clientName:"",clientEmail:"",dueDate:"",description:"",amount:"",walletAddress:""})}catch(e){console.error("Failed to create invoice:",e),n.oR.error("Failed to create invoice")}finally{d(!1)}};return e?(0,s.jsx)("div",{className:"p-4 rounded-lg mt-10",children:(0,s.jsxs)("form",{onSubmit:m,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"clientName",className:"block text-sm font-medium mb-1",children:"Client Name"}),(0,s.jsx)("input",{type:"text",id:"clientName",name:"clientName",value:t.clientName,onChange:o,className:"w-full p-2 border-b border-gray-300 dark:border-gray-600 bg-transparent focus:outline-none focus:border-blue-500",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"clientEmail",className:"block text-sm font-medium mb-1",children:"Client Email *"}),(0,s.jsx)("input",{type:"email",id:"clientEmail",name:"clientEmail",value:t.clientEmail,onChange:o,className:"w-full p-2 border-b border-gray-300 dark:border-gray-600 bg-transparent focus:outline-none focus:border-blue-500",required:!0})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"amount",className:"block text-sm font-medium mb-1",children:"Amount *"}),(0,s.jsx)("input",{type:"number",id:"amount",name:"amount",value:t.amount,onChange:o,min:"0.000000001",step:"0.000000001",className:"w-full p-2 border-b border-gray-300 dark:border-gray-600 bg-transparent focus:outline-none focus:border-blue-500",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"dueDate",className:"block text-sm font-medium mb-1",children:"Due Date *"}),(0,s.jsx)("input",{type:"date",id:"dueDate",name:"dueDate",value:t.dueDate,onChange:o,min:new Date().toISOString().split("T")[0],className:"w-full p-2 border-b border-gray-300 dark:border-gray-600 bg-transparent focus:outline-none focus:border-blue-500",required:!0})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"walletAddress",className:"block text-sm font-medium mb-1",children:"Your Wallet Address (to receive payment)"}),(0,s.jsx)("input",{type:"text",id:"walletAddress",name:"walletAddress",value:t.walletAddress,onChange:o,className:"w-full p-2 border-b border-gray-300 dark:border-gray-600 bg-transparent focus:outline-none focus:border-blue-500",placeholder:"0x..."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium mb-1",children:"Description"}),(0,s.jsx)("textarea",{id:"description",name:"description",value:t.description,onChange:o,rows:3,className:"w-full p-2 border-b border-gray-300 dark:border-gray-600 bg-transparent focus:outline-none focus:border-blue-500"})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",id:"addToAddressBook",checked:i,onChange:e=>{c(e.target.checked)},className:"mr-2 h-4 w-4"}),(0,s.jsx)("label",{htmlFor:"addToAddressBook",className:"text-sm text-gray-700 dark:text-gray-300",children:"Add client to address book"})]}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)("button",{type:"submit",disabled:l,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-blue-400",children:l?"Creating...":"Create Invoice"})})]})}):(0,s.jsx)("div",{className:"p-4 text-center",children:"Please sign in to create invoices."})};var eo=a(57340),em=a(6874),ex=a.n(em),eu=a(72883),eg=a(53999);let eb=eu.bL,ey=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(eu.B8,{ref:t,className:(0,eg.cn)("inline-flex h-10 items-center justify-center rounded-md bg-gray-100 p-1 text-gray-500 dark:bg-gray-800 dark:text-gray-400",a),...r})});ey.displayName=eu.B8.displayName;let eh=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(eu.l9,{ref:t,className:(0,eg.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-400 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-white data-[state=active]:text-gray-950 data-[state=active]:shadow-sm dark:ring-offset-gray-950 dark:focus-visible:ring-gray-800 dark:data-[state=active]:bg-gray-950 dark:data-[state=active]:text-gray-50",a),...r})});eh.displayName=eu.l9.displayName;let ep=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(eu.UC,{ref:t,className:(0,eg.cn)("mt-2 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-400 focus-visible:ring-offset-2 dark:ring-offset-gray-950 dark:focus-visible:ring-gray-800",a),...r})});ep.displayName=eu.UC.displayName;let ef=function(){var e;let{currentNetwork:t}=(null===i.h||void 0===i.h?void 0:(0,i.h)())||{currentNetwork:"testnet"},a=(0,d.YL)(),[l,n]=(0,r.useState)(null==(e=u.at[t])?void 0:e[0]),[c,o]=(0,r.useState)(0);return(0,s.jsxs)("div",{className:"relative h-screen w-screen dark:text-white text-black p-6 z-10",children:[(0,s.jsx)("div",{className:"absolute top-4 left-4",children:(0,s.jsx)(ex(),{href:"/",children:(0,s.jsx)(eo.A,{className:"text-black dark:hover:text-gray-200 hover:text-gray-800 dark:text-white",size:30})})}),(0,s.jsxs)("div",{className:"flex flex-col max-w-screen max-h-screen items-center m-10",children:[(0,s.jsx)(v,{selectedToken:l,onTokenChange:e=>{n(e)}}),a?(0,s.jsxs)(eb,{defaultValue:"transfer",className:"min-w-[90%]",children:[(0,s.jsxs)(ey,{className:"grid w-full grid-cols-4",children:[(0,s.jsx)(eh,{value:"transfer",children:"Secure Transfer"}),(0,s.jsx)(eh,{value:"invoices",children:"My Invoices"}),(0,s.jsx)(eh,{value:"splitbills",children:"Split Bills"}),(0,s.jsx)(eh,{value:"create-invoice",children:"Create Invoice"})]}),(0,s.jsx)(ep,{value:"transfer",children:(0,s.jsx)(W,{selectedToken:l})}),(0,s.jsx)(ep,{value:"invoices",children:(0,s.jsx)(ei,{selectedToken:l})}),(0,s.jsx)(ep,{value:"splitbills",children:(0,s.jsx)(ee,{selectedToken:l,refreshTrigger:c})}),(0,s.jsx)(ep,{value:"create-invoice",children:(0,s.jsx)(ec,{})})]}):(0,s.jsx)("div",{className:"dark:text-white text-black border-2 border-blue-200 p-4 rounded-md",children:(0,s.jsx)("p",{children:"Please connect your wallet to use these features."})})]})]})}},63737:(e,t,a)=>{Promise.resolve().then(a.bind(a,29904))}},e=>{var t=t=>e(e.s=t);e.O(0,[844,4277,4134,3464,2497,8098,8021,2901,2897,9546,8480,3791,5196,813,8441,1684,7358],()=>t(63737)),_N_E=e.O()}]);