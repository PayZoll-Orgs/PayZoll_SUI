"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5196],{21934:(e,t,r)=>{r.d(t,{U:()=>s});var a=r(74228);let s={getAllEmployees:async()=>(await a.A.get("/employee/")).data,getEmployeeByWallet:async e=>(await a.A.get("/employee/".concat(e))).data,addEmployee:async e=>(await a.A.post("/employee/add",e)).data,getEmployeePayroll:async e=>(await a.A.get("/employee/payroll/".concat(e))).data,bulkUploadEmployees:async e=>(await a.A.post("/employee/bulk-upload",e,{headers:{"Content-Type":"multipart/form-data"}})).data,updateEmployee:async(e,t)=>(await a.A.patch("/employee/update/".concat(e),t)).data,deleteEmployee:async e=>(await a.A.delete("/employee/delete/".concat(e))).data}},35196:(e,t,r)=>{r.d(t,{AuthProvider:()=>g,O:()=>h,A:()=>p});var a=r(95155),s=r(12115),o=r(35695),l=r(31530),i=r(64767);r(21934),r(94860),r(74228),r(51931);var n=r(10351);let d=e=>{let{t,icon:r,title:s,message:o,borderColor:l}=e;return(0,a.jsx)("div",{className:"".concat(t.visible?"animate-enter":"animate-leave"," max-w-md w-full bg-white dark:bg-black dark:text-white text-black shadow-lg rounded-lg pointer-events-auto flex border-l-4 ").concat(l),children:(0,a.jsx)("div",{className:"flex-1 w-0 p-4",children:(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)("div",{className:"flex-shrink-0 pt-0.5",children:r}),(0,a.jsxs)("div",{className:"ml-3 flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:s}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-800 dark:text-gray-400",children:o})]})]})})})},c=["/","/login","/register","/forgot-password","/pages/services","/pages/auth","/pages/ramps","/pages/admin","/pages/p2p","/pages/about"],u=["/pages/payroll"],m=(0,s.createContext)(void 0),g=e=>{let{children:t}=e,[r,g]=(0,s.useState)(null),[p,h]=(0,s.useState)(!0),[x,y]=(0,s.useState)(null),[w,v]=(0,s.useState)(!1),f=(0,o.useRouter)(),b=(0,o.usePathname)(),j=e=>{try{let t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent(atob(t).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(r)}catch(e){return console.error("Error parsing token:",e),null}},A=e=>!e||Date.now()/1e3>e,S=()=>{localStorage.removeItem("authToken"),localStorage.removeItem("user"),g(null),y(null),f.replace("/")},k=async e=>{try{h(!0);let t=await i.Z.login(e);if(null==t?void 0:t.token){let e=j(t.token);if(e)y(e.exp),localStorage.setItem("authToken",t.token);else throw Error("Invalid token structure received")}else throw Error("No authentication token received");if(null==t?void 0:t.safeUser)return g(t.safeUser),localStorage.setItem("user",JSON.stringify(t.safeUser)),l.oR.custom(e=>(0,a.jsx)(d,{t:e,icon:(0,a.jsx)(n.A3x,{className:"h-6 w-6 text-green-500"}),title:"Login Successful",message:"Welcome back, ".concat(t.safeUser.email,"!"),borderColor:"border-green-500"})),t.safeUser.isAdmin?f.push("/pages/payroll"):f.push("/pages/employee"),{success:!0};throw Error("Invalid user data received")}catch(s){var t,r;console.error("Login error:",s);let e=(null==(r=s.response)||null==(t=r.data)?void 0:t.message)||"Failed to login. Please try again.";return l.oR.custom(t=>(0,a.jsx)(d,{t:t,icon:(0,a.jsx)(n.q_G,{className:"h-6 w-6 text-red-500"}),title:"Login Failed",message:e,borderColor:"border-red-500"})),{success:!1,error:e}}finally{h(!1)}},N=async e=>{try{return h(!0),await i.Z.register(e),l.oR.custom(e=>(0,a.jsx)(d,{t:e,icon:(0,a.jsx)(n.vq3,{className:"h-6 w-6 text-green-500"}),title:"Registration Successful",message:"Account created. Logging you in...",borderColor:"border-green-500"}),{duration:2e3}),await k({email:e.email,password:e.password})}catch(s){var t,r;console.error("Registration error:",s);let e=(null==(r=s.response)||null==(t=r.data)?void 0:t.message)||"Failed to register. Please try again.";return l.oR.custom(t=>(0,a.jsx)(d,{t:t,icon:(0,a.jsx)(n.q_G,{className:"h-6 w-6 text-red-500"}),title:"Registration Failed",message:e,borderColor:"border-red-500"})),{success:!1,error:e}}finally{h(!1)}};(0,s.useEffect)(()=>{if(!x)return;let e=x-Date.now()/1e3,t=null,s=null;return e>300?(t=setTimeout(()=>{l.oR.custom(e=>(0,a.jsx)(d,{t:e,icon:(0,a.jsx)(n.eHT,{className:"h-6 w-6 text-yellow-500"}),title:"Session Warning",message:"Your session will expire in 5 minutes.",borderColor:"border-yellow-500"}),{duration:1e4})},(e-300)*1e3),s=setTimeout(()=>{S(),l.oR.custom(e=>(0,a.jsx)(d,{t:e,icon:(0,a.jsx)(n.Ohp,{className:"h-6 w-6 text-red-500"}),title:"Session Expired",message:"Your session has ended. Please login again.",borderColor:"border-red-500"}))},1e3*e)):e>0?s=setTimeout(()=>{S(),l.oR.custom(e=>(0,a.jsx)(d,{t:e,icon:(0,a.jsx)(n.Ohp,{className:"h-6 w-6 text-red-500"}),title:"Session Expired",message:"Your session has ended. Please login again.",borderColor:"border-red-500"}))},1e3*e):r&&(S(),l.oR.custom(e=>(0,a.jsx)(d,{t:e,icon:(0,a.jsx)(n.Ohp,{className:"h-6 w-6 text-red-500"}),title:"Session Expired",message:"Your session has ended. Please login again.",borderColor:"border-red-500"}))),()=>{t&&clearTimeout(t),s&&clearTimeout(s)}},[x,r]);let E=async()=>{let e=localStorage.getItem("authToken"),t=localStorage.getItem("user");if(!e||!t)return g(null),c.includes(b||"")||"/"===b||f.replace("/"),h(!1),v(!0),!1;try{let r=j(e);if(!r||A(r.exp))throw Error("Token expired");y(r.exp);let s=JSON.parse(t);if(g(s),u.some(e=>null==b?void 0:b.startsWith(e))&&!s.isAdmin)return l.oR.custom(e=>(0,a.jsx)(d,{t:e,icon:(0,a.jsx)(n.del,{className:"h-6 w-6 text-red-500"}),title:"Access Denied",message:"You don't have permission to access this page.",borderColor:"border-red-500"})),f.replace("/"),h(!1),v(!0),!1;return h(!1),v(!0),!0}catch(e){return l.oR.custom(e=>(0,a.jsx)(d,{t:e,icon:(0,a.jsx)(n.Ohp,{className:"h-6 w-6 text-red-500"}),title:"Session Expired",message:"Your session is invalid or has ended. Please login again.",borderColor:"border-red-500"})),S(),h(!1),v(!0),!1}};return(0,s.useEffect)(()=>{E()},[]),(0,s.useEffect)(()=>{if(w){let e=localStorage.getItem("authToken"),t=localStorage.getItem("user");if(!e||!t){c.includes(b||"")||"/"===b||f.replace("/");return}r&&u.some(e=>null==b?void 0:b.startsWith(e))&&!r.isAdmin&&(l.oR.custom(e=>(0,a.jsx)(d,{t:e,icon:(0,a.jsx)(n.del,{className:"h-6 w-6 text-red-500"}),title:"Access Denied",message:"You don't have permission to access this page.",borderColor:"border-red-500"})),f.replace("/"))}},[b,w,r]),(0,s.useEffect)(()=>{let e=setInterval(async()=>{try{let e=await i.Z.ping();e?console.log("Ping successful:",e):console.log("Ping failed")}catch(e){console.log("Ping error:",e)}},45e3);return()=>clearInterval(e)},[]),(0,a.jsx)(m.Provider,{value:{user:r,isAuthenticated:!!r,isLoading:p,isAdmin:null==r?void 0:r.isAdmin,logout:S,login:k,register:N},children:t})},p=()=>{let e=(0,s.useContext)(m);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},h=e=>{let{route:t,children:r,requireAdmin:i=!1}=e,{user:c,isLoading:u,isAdmin:m}=p(),g=(0,o.useRouter)(),[h,x]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{if(!u){if(!c)return void g.replace("/pages/auth");if(i&&!c.isAdmin){l.oR.custom(e=>(0,a.jsx)(d,{t:e,icon:(0,a.jsx)(n.F5$,{className:"h-6 w-6 text-red-500"}),title:"Admin Required",message:"You need administrator privileges for this area.",borderColor:"border-red-500"})),g.replace("/");return}x(!0)}},[c,u,i,m,g,t]),u)?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen min-w-screen",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):h?(0,a.jsx)(a.Fragment,{children:r}):null}},46520:(e,t,r)=>{r.d(t,{p:()=>a});let a="https://payzoll-server-pharos.onrender.com"},51931:(e,t,r)=>{r.d(t,{A:()=>s});var a=r(74228);let s={subscribeToNewsletter:async e=>{try{return(await a.A.post("/email/subscribe",e)).data}catch(e){return console.error("Newsletter subscription error:",e),{success:!1,message:e.message||"Failed to subscribe to newsletter",error:e.toString()}}},joinWaitlist:async e=>{try{return(await a.A.post("/email/waitlist",e)).data}catch(e){return console.error("Waitlist registration error:",e),{success:!1,message:e.message||"Failed to join waitlist",error:e.toString()}}}}},64767:(e,t,r)=>{r.d(t,{Z:()=>s});var a=r(74228);let s={login:async e=>{var t,r;let s=await a.A.post("/auth/login",e);return(null==(t=s.data)?void 0:t.token)&&localStorage.setItem("authToken",s.data.token),(null==(r=s.data)?void 0:r.safeUser)&&localStorage.setItem("user",JSON.stringify(s.data.safeUser)),console.log("Login response:",s.data),s.data},register:async e=>(await a.A.post("/auth/register",e)).data,forgotPassword:async e=>(await a.A.post("/auth/forgotPassword",{email:e})).data,ping:async()=>(await a.A.post("/auth/ping")).data}},74228:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(23464);let s=r(46520).p,o=a.A.create({baseURL:s,headers:{"Content-Type":"application/json"}});o.interceptors.request.use(e=>{let t=localStorage.getItem("authToken");return t&&e.headers&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),o.interceptors.response.use(e=>e,e=>{let{response:t}=e;return(null==t?void 0:t.status)===401&&(localStorage.removeItem("authToken"),window.location.href="/"),Promise.reject({status:null==t?void 0:t.status,message:"object"==typeof(null==t?void 0:t.data)&&(null==t?void 0:t.data)&&"message"in t.data?t.data.message:"An unexpected error occurred",data:null==t?void 0:t.data,originalError:e})});let l=o},94860:(e,t,r)=>{r.d(t,{U:()=>s});var a=r(74228);let s={addPayroll:async e=>(await a.A.post("/payroll/add",e)).data,getPayrollHistory:async()=>(await a.A.get("/payroll/history")).data}}}]);